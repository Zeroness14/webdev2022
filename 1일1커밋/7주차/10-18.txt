효율적인 가상화 비율을 찾기 위해 필요한 요소들

효율적인 가상화 비율을 찾기 위해서는 가상머신을 만들기 위한 Flavor(가상머신 사양) 종류와 하드웨어 스팩이 필요하다. 
예를 들어 아래와 같이 일반적으로 많이 사용하는 표준 Flavor들과 메모리를 많이 사용하는 경우의 메모리 최적화용 Flavor가 있다고 가정하자.
그리고, 아래와 같은 스팩을 가진 하드웨어가 있다고 가정하자.
 예시)
컴퓨트 1 - CPU 16 Cores, 512 GB
컴퓨트 2 - CPU 40 Cores, 576 GB
일반적으로 클라우드 서비스를 사용할 경우에는 호스트 자원의 70% 이하를 사용한다.  
그리고, 여기에 CPU 가상화율을 하이퍼쓰레드 적용부터 4:1까지를 계산해보면 아래와 같이 계산이 된다.


1. 효율적인 가상화 비율 찾기
자 이제 이 두가지 요소를 가지고 효율적으로 사용할 수 있는 가상화 비율을 찾아보면 먼저 Compute1 과 같은 사양의 하드웨어로 구성이 되어 있을 경우를 먼저 계산해 보면 일반 표준 Flavor를 사용할 경우 메모리를 가장 효율적으로 사용하기 위해서는  xlarge(CPU 4, Memory 16) 스팩의 가상머신을 22개 만들 수 있는 CPU 가상화율 4:1을 사용하는것이 가장 효율적이다. 
그런데, High Memory용 Flavor를 사용하면 CPU 가상화율을 2:1로 했을경우 메모리를 가장 효율적으로 사용할 수 있다.

그래서, 이와 같은 하드웨어 스팩(CPU - 16 cores, Memory - 512 GB) 을 사용할 경우에는 메모리를 많이 사용하는 인스턴스를 배치하여 사용하는 것이 좋다는 결론이 나온다. 
그리고, 가상화 비율을 2:1을 사용하는 것이 좋다는 것도 알 수 있다. 

이번에는 Compute2와 같은 하드웨어 스팩(CPU - 40 cores, Memory - 576 GB)을 표준 Flavor와 High Memory Flavor를 사용하는 경우를 살펴보자. 
이 같은 경우에는 표준 Flavor를 사용할 경우에는 xlarge(CPU 4, Memory 16) 를 사용하는 가상 머신을 50개 생성할 수 있는 CPU 가상화 2:1을 사용하는 것이 메모리를 가장 효율적으로 사용하는 방법이며, High Memory Flavor를 사용할 경우에는 단순히 하이퍼쓰레드만 적용해도 메모리를 효율적으로 사용할 수 있음을 알 수 있다. 


2. 결론
클라우드 서비스에서 가장 효율적인 가상화율을 찾기 위해서는 가상머신 위에 어떤 서비스가 올라가는지를 반드시 알아야 하며, 가상 자원은 호스트 서버 자원의 70%를 넘지 말아야 한다. 
그리고, CPU와 메모리 비율에 따라 어떤 Flavor 정책을 가져갈 것인지 아니면 주로 사용하는 Flavor를 조사해 어떻게 가상화 비율을 가져가면 메모리를 가장 효율적으로 사용할 수 있는지를 계산해 보는것이 가장 좋은 클라우드 자원 사용 방법이 아닐까? 라는 생각을 해 본다. 
물론 고성능을 원한다면 가상화를 안쓰는것이 가장 좋은 방법이지 않을까 생각을 해본다.